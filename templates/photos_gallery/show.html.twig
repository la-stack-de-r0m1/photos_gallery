{% extends 'base.html.twig' %}

{% form_theme formComment 'bootstrap_4_layout.html.twig' %}

{% block body %}
<div class="simple-wrapper">
    <div>
        {% if error is defined %}
            <div class="alert alert-danger">{{ error }}</div>
        {% elseif adding %}
            <div class="alert alert-success">âœ… Comment successfully added!</div>
        {% endif %}

        <h2>{{ picture.name }}</h2>
        <div class="metadata">
            <p>Added {{ picture.addedAt | date('y/m/d at H:i') }}</p>
            <p>Tag: #{{ picture.tag.name }}
            {% if is_granted('ROLE_ADMIN') %}
                <a href="{{ path('photos_del', {'slugName' : picture.slugName}) }}" class="btn btn-danger"
                    onclick="return confirm('Are you sure you want to delete this item?')">
                Delete</a></p>
            {% endif %}
        </div>
        <div class="content">
            <img src="{{ '/uploads/pictures/' ~ picture.pictureFilename }}" alt="{{ picture.name }}">
        </div>
        <div class="description">
            {{ picture.description }}
        </div>
        
        <div align="center">
            {% if previousPicture %}
                <a href="{{ path('photos_show', {'slugName' : previousPicture.slugName}) }}"
                    class="btn btn-secondary">< Previous</a>
            {% else %}
                <a href="#" class="btn btn-secondary disabled ">Next ></a>
            {% endif %}

            {% if nextPicture %}
                <a href="{{ path('photos_show', {'slugName' : nextPicture.slugName}) }}"
                    class="btn btn-secondary">Next ></a>
            {% else %}
                <a href="#" class="btn btn-secondary disabled ">Next ></a>
            {% endif %}
        </div>

    </div>
    <hr>
    <section id="comments">
        <h2>{{ picture.comments | length }} comment(s):</h2>
        {% for comment in picture.comments %}

            <div class="comment">
                <div class="row">
                    <div class="col-3">
                        {{ comment.author }}
                        <small>(Created the {{ comment.createdAt | date('y/m/d at H:i') }})
                        </small>      
                    </div>
                    <div class="col-9">
                        {{ comment.content }}
                    </div>
                </div>
            </div>
            <hr>

        {% endfor %}
    </section>
    <section id="add_comment">

        {% if not app.user %}
            <h4>Adding a comment:</h4>
        {% else %}
            <h4>Comment as <strong>{{ app.user.username }}</strong>: </h4>
        {% endif %}
        
        {{ form_start(formComment) }}
            {% if not app.user %}
                {{ form_row(
                    formComment.author,
                    {'attr': {'placeholder': 'Enter your name'}}
                )}}
            {% else %}
                {{ form_row(
                    formComment.author,
                    {
                        'attr': {'value': app.user.username },
                    }
                )}}
            {% endif %}
        
            {{ form_row(
                formComment.content
            )}}
            
            <hr>
            {{ form_row(formComment._token) }}
            <button type="submit" class="btn btn-success">Add comment</button
        
        {{ form_end(formComment) }}
    </section>
</div>
{% endblock %}